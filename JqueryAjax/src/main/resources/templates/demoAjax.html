<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1" />

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<link
	href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"
	rel="stylesheet" />
<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script
	src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<title>Insert title here</title>
</head>
<body>
	<div class="container">
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<a class="navbar-brand" href="#">Navbar</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse"
				data-target="#navbarSupportedContent"
				aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item active"><a class="nav-link" href="#">Home
							<span class="sr-only">(current)</span>
					</a></li>
					<li class="nav-item"><a class="nav-link" href="#">Link</a></li>
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false"> Dropdown </a>
						<div class="dropdown-menu" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" href="#">Action</a> <a
								class="dropdown-item" href="#">Another action</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#">Something else here</a>
						</div></li>
					<li class="nav-item"><a class="nav-link disabled" href="#">Disabled</a>
					</li>
				</ul>
				<form class="form-inline my-2 my-lg-0">
					<input class="form-control mr-sm-2" type="search"
						onkeyup="searchInfoUser(this);" placeholder="Search"
						aria-label="Search">
				</form>
			</div>
		</nav>
		<form>
			<div class="row">
				<div class="form-group col-md-4">
					<select class="form-control" id="roleId">
						<option value="">Choose...</option>
						<option th:each="role:${roles}" th:value="${role.roleId}"
							th:text="${role.name}"></option>

					</select>
				</div>
				<div class="form-group col-md-4">
					<select class="form-control" id="status">
						<option value="">Choose...</option>
						<option value="0">InActive</option>
						<option value="1">Active</option>
					</select>
				</div>
				<div class="form-group col-md-4">
					<button type="button" class="btn btn-success" onclick="filter()">Submit</button>
				</div>
			</div>

		</form>
		<table class="table table-striped" id="list-user">
			<thead>
				<tr>
             
					<th><input type="checkbox" id="selectall" /></th>
					<th class="sort">STT<i id="userId" class="fa fa-sort-asc"
						aria-hidden="true"></i></th>
					<th class="sort">FullName<i id="fullName"
						class="fa fa-sort-asc" aria-hidden="true"></i></th>
					<th class="sort">Email<i id="email" class="fa fa-sort-asc"
						aria-hidden="true"></i></th>
					<th class="sort">UserName<i id="userName"
						class="fa fa-sort-asc" aria-hidden="true"></i></th>
					<th class="sort">Password<i id="password"
						class="fa fa-sort-asc" aria-hidden="true"></i></th>
					<th class="sort">Phone<i id="phone" class="fa fa-sort-asc"
						aria-hidden="true"></i></th>
					<th class="sort">Status<i id="status" class="fa fa-sort-asc"
						aria-hidden="true"></i></th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>

			</tbody>
		</table>
		<div class="form-row">
			<div class="form-group col-md-1">
				<select onchange="OnchanPage(this)" class="form-control">
					<option value="5">5</option>
					<option value="10">10</option>
					<option value="15">15</option>
				</select>
			</div>
		</div>

		<form>
			<div class="row">
				<input id="Id" type="hidden">
				<div class="form-group col-md-4">
					<input id="Email" type="text" class="form-control ">
				</div>
				<div class="form-group col-md-4">
					<input id="Password" type="text" class="form-control ">
				</div>
				<div class="form-group col-md-4">
					<button type="button" class="btn btn-info" onclick="addUser()">Save</button>
					<input type="reset" class="btn btn-success" id="configreset"
						value="Reset">
				</div>
			</div>

		</form>

	</div>
	<div class="modal" id="myModal">
		<div class="modal-dialog">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Modal Heading</h4>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					<form>
						<div th:each="role: ${roles}">
							<input class="roleId" type="checkbox" th:value="${role.roleId}" >
							<span th:text="${role.name}"></span>
						</div>

						<button type="button" onclick="addUser()">Save</button>
					</form>
				</div>

				<!-- Modal footer -->
				<div class="modal-footer">

					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				</div>

			</div>
		</div>
	</div>
	<script type="text/javascript">
	
	var tsort={sortName:"",sort:true,fullName:"",pageSize:5,roleId:"",status:""};
	
	var roles = [];
	
		$(document).ready(function() {
			listUser();
			getRoles();
			$('#form_id').trigger("reset");	    	
		});
		function filter(){	
			tsort.status=$('#status').val();
			tsort.roleId=$('#roleId').val();
			console.log(tsort.status);
			var userJSON = JSON.stringify(tsort);
			$
					.ajax({
						url : 'http://localhost:8080/users',userJSON,
						method : 'POST',
						data : userJSON,
						contentType : "application/json; charset=utf-8",
						success : function(data) {
							$("#list-user").find("tbody").empty();
							$(data)
									.each(
											function(index, user) {
												
												var tableBody = "<tr><td>" + "<input type='checkbox' class='case' name='case' value=" + user.userId + ">" + "</td><td>"
														+ user.userId
														+ "</td><td>"
														+ user.fullName
														+ "</td><td>"
														+ user.email
														+ "</td><td>"
														+ user.userName
														+ "</td><td>"
														+ user.password
														+ "</td><td>"
														+ user.phone
														+ "</td><td>"
														+ user.status
														+ "</td><td><button type='button' class='btn btn-danger' onClick='deleteUser("
														+ user.userId
														+ ")'>Delete</button><button type='button' class='btn btn-info' onClick='getUser("+ user.userId +")'>Edit</button><button type='button' class='btn btn-info' data-toggle='modal' data-target='#myModal' onClick='getRole("+ user.userId +")'>Edit Role</button>"
														+ "</td></tr>";

												$("table tbody").append(
														tableBody);

											})
						}
					})
		}
		
		function addUser() {
		   var user={userId,email,password};
		   user.userId=document.getElementById('Id').value;
           user.email=document.getElementById('Email').value;
           user.password=document.getElementById('Password').value;  
           var userJSON = JSON.stringify(user);
           if(user.userId==""){
        	   $.ajax({
            	   url:'http://localhost:8080/add-user',user,
            	   method:'POST',
            	   data:userJSON,
            	   contentType : "application/json; charset=utf-8",
            	   success:function(data){
            		   $("#list-user").find("tbody").empty();
            		   listUser();
            		   user.userId=document.getElementById('Id').value;
                       user.email=document.getElementById('Email').value='';
                       user.password=document.getElementById('Password').value='';  
            	   }
               })
           }else{
        	   $.ajax({
            	   url:'http://localhost:8080/edit-user',user,
            	   method:'PUT',
            	   data:userJSON,
            	   contentType : "application/json; charset=utf-8",
            	   success:function(data){
            		   $("#list-user").find("tbody").empty();
            		   listUser();
            		   user.userId=document.getElementById('Id').value;
                       user.email=document.getElementById('Email').value='';
                       user.password=document.getElementById('Password').value=''; 
            	   }
               })       	   
           }         
		}
		function getRole(userId){			
			 $.ajax({
				url:'http://localhost:8080/get-user/' + userId,
				method:'GET',
				contentType : "application/json; charset=utf-8",
				success:function(data){
					for(let i=0;i<data.roles.length;i++){
						console.log(data.roles[i].roleId);
						$(".roleId").val(data.roles[i].roleId);
					}
										
				}
			})				
		}
		
		function getUser(userId){
			$.ajax({
				url:'http://localhost:8080/get-user/' + userId,
				method:'GET',
				contentType : "application/json; charset=utf-8",
				success:function(data){
					$("#Id").val(data.userId);
					$("#Email").val(data.email);
					$("#Password").val(data.password);
										
				}
			})				
		}
		function getRoles(userId){
			$.ajax({
				url:'http://localhost:8080/list-role',
				method:'GET',
				contentType : "application/json; charset=utf-8",
				success:function(data){
					console.log(data);
										
				}
			})				
		}
		function deleteUser(userId) {
			$.ajax({
				url : 'http://localhost:8080/delete/' + userId,
				method : 'DELETE',
				data: userId,
				dataType : 'json',
				success : function(data) {	
					
				},complete: function(data){
					$("#list-user").find("tbody").empty();
         		   listUser();
                }		  
			})
		}
		
		function OnchanPage(value){
			var number=value.value;
			tsort.pageSize=number;
			var userJSON = JSON.stringify(tsort);
			$
					.ajax({
						url : 'http://localhost:8080/users',userJSON,
						method : 'POST',
						data : userJSON,
						contentType : "application/json; charset=utf-8",
						success : function(data) {
							$("#list-user").find("tbody").empty();
							$(data)
									.each(
											function(index, user) {
												
												var tableBody = "<tr><td>" + "<input type='checkbox' class='case' name='case' value=" + user.userId + ">" + "</td><td>"
														+ user.userId
														+ "</td><td>"
														+ user.fullName
														+ "</td><td>"
														+ user.email
														+ "</td><td>"
														+ user.userName
														+ "</td><td>"
														+ user.password
														+ "</td><td>"
														+ user.phone
														+ "</td><td>"
														+ user.status
														+ "</td><td><button type='button' class='btn btn-danger' onClick='deleteUser("
														+ user.userId
														+ ")'>Delete</button><button type='button' class='btn btn-info' onClick='getUser("+ user.userId +")'>Edit</button><button type='button' class='btn btn-primary' data-toggle='modal' data-target='#myModal' onClick='getRole("+ user.userId +")'>Edit Role</button>"
														+ "</td></tr>";

												$("table tbody").append(
														tableBody);

											})
						}
					})
		}
		
		function searchInfoUser(user){
			var keyword=user.value;
			tsort.fullName=keyword;
			var userJSON = JSON.stringify(tsort);
			$
					.ajax({
						url : 'http://localhost:8080/users',userJSON,
						method : 'POST',
						data : userJSON,
						contentType : "application/json; charset=utf-8",
						success : function(data) {
							$("#list-user").find("tbody").empty();
							$(data)
									.each(
											function(index, user) {
												
												var tableBody = "<tr><td>" + "<input type='checkbox' class='case' name='case' value=" + user.userId + ">" + "</td><td>"
														+ user.userId
														+ "</td><td>"
														+ user.fullName
														+ "</td><td>"
														+ user.email
														+ "</td><td>"
														+ user.userName
														+ "</td><td>"
														+ user.password
														+ "</td><td>"
														+ user.phone
														+ "</td><td>"
														+ user.status
														+ "</td><td><button type='button' class='btn btn-danger' onClick='deleteUser("
														+ user.userId
														+ ")'>Delete</button><button type='button' class='btn btn-info' onClick='getUser("+ user.userId +")'>Edit</button><button type='button' class='btn btn-primary' data-toggle='modal' data-target='#myModal' onClick='getRole("+ user.userId +")'>Edit Role</button>"
														+ "</td></tr>";

												$("table tbody").append(
														tableBody);

											})
						}
					})
		}
		
		$(".sort i").click(function(){			
			var sortName=this.id;
			tsort.sortName=sortName;
			tsort.sort=!tsort.sort;
			var userJSON = JSON.stringify(tsort);
			$
					.ajax({
						url : 'http://localhost:8080/users',userJSON,
						method : 'POST',
						data : userJSON,
						contentType : "application/json; charset=utf-8",
						success : function(data) {
							$("#list-user").find("tbody").empty();
							$(data)
									.each(
											function(index, user) {
												var tableBody = "<tr><td>" + "<input type='checkbox' class='case' name='case' value=" + user.userId + ">" + "</td><td>"
														+ user.userId
														+ "</td><td>"
														+ user.fullName
														+ "</td><td>"
														+ user.email
														+ "</td><td>"
														+ user.userName
														+ "</td><td>"
														+ user.password
														+ "</td><td>"
														+ user.phone
														+ "</td><td>"
														+ user.status
														+ "</td><td><button type='button' class='btn btn-danger' onClick='deleteUser("
														+ user.userId
														+ ")'>Delete</button><button type='button' class='btn btn-info' onClick='getUser("+ user.userId +")'>Edit</button><button type='button' class='btn btn-primary' data-toggle='modal' data-target='#myModal' onClick='getRole("+ user.userId +")'>Edit Role</button>"
														+ "</td></tr>";

												$("table tbody").append(
														tableBody);

											})
						}
					})
		})
		
		
		function listUser() {		
			var userJSON = JSON.stringify(tsort);
			
			$
					.ajax({
						url : 'http://localhost:8080/users',userJSON,
						method : 'POST',
						data : userJSON,
						contentType : "application/json; charset=utf-8",
						success : function(data) {
							$(data)
									.each(
											function(index, user) {	
												var tableBody = "<tr><td>" + "<input type='checkbox' class='case'  value=" + user.userId + ">" + "</td><td>"
														+ user.userId
														+ "</td><td>"
														+ user.fullName
														+ "</td><td>"
														+ user.email
														+ "</td><td>"
														+ user.userName
														+ "</td><td>"
														+ user.password
														+ "</td><td>"
														+ user.phone
														+ "</td><td>"
														+ user.status
														+ "</td><td><button type='button' class='btn btn-danger' onClick='deleteUser("
														+ user.userId
														+ ")'>Delete</button><button type='button' class='btn btn-info' onClick='getUser("+ user.userId +")'>Edit</button><button type='button' class='btn btn-primary' data-toggle='modal' data-target='#myModal' onClick='getRole("+ user.userId +")'>Edit Role</button>"
														+ "</td></tr>";
												$("table tbody").append(
														tableBody);

											})
						}
					})
		}
		

		

			$("#selectall").click(function () {
				  $('.case').attr('checked', this.checked);
				  
				  
			});

			
			$("table tbody input.case :checkbox" ).click(function(){
				console.log("aaaaaaaaa");
				/* if($(".case").length == $(".case:checked").length) {
					$("#selectall").attr("checked", "checked");
				} else {
					$("#selectall").removeAttr("checked");
				} */

			});
		
		
	</script>
</body>

</html>